<?php/** * PRODUCTOS_MESAS_MYSQL.class.php * PRODUCTOS_MESAS **/class PRODUCTOS_MESAS_MYSQL {	public static $DATABASE_NAME = 'posgourmet';	public static $TABLE_NAME = 'productos_mesas_mysql';public $CONN;	/**	 * @var FACTURA	 */	public $FACTURA ;	/**	 * @var ORDEN	 */	public $ORDEN ;	/**	 * @var ITEM	 */	public $ITEM ;	/**	 * @var COD_PROD	 */	public $COD_PROD ;	/**	 * @var CANTIDAD	 */	public $CANTIDAD ;	/**	 * @var PRE_COSTO	 */	public $PRE_COSTO ;	/**	 * @var PRE_VENTA	 */	public $PRE_VENTA ;	/**	 * @var CAM_OF	 */	public $CAM_OF ;	/**	 * @var F_VENTA	 */	public $F_VENTA ;	/**	 * @var DHORAVEN	 */	public $DHORAVEN ;	/**	 * @var NOM_PROD	 */	public $NOM_PROD ;	/**	 * @var UNIDAD	 */	public $UNIDAD ;	/**	 * @var PENDIENTE	 */	public $PENDIENTE ;	/**	 * @var ANULADO	 */	public $ANULADO ;	/**	 * @var PRESA	 */	public $PRESA ;	/**	 * @var GRUPO	 */	public $GRUPO ;	/**	 * @var CERRADO	 */	public $CERRADO ;	/**	 * @var TURNO	 */	public $TURNO ;	/**	 * @var FAMILIA	 */	public $FAMILIA ;	/**	 * @var UNID	 */	public $UNID ;	/**	 * @var SALIDA	 */	public $SALIDA ;	/**	 * @var FORTAX	 */	public $FORTAX ;	/**	 * @var TOT_DES	 */	public $TOT_DES ;	/**	 * @var FACTOR	 */	public $FACTOR ;	/**	 * @var AGRUPA1	 */	public $AGRUPA1 ;	/**	 * @var AGRUPA2	 */	public $AGRUPA2 ;	/**	 * @var AGRUPA3	 */	public $AGRUPA3 ;	/**	 * @var COD_GRUPO	 */	public $COD_GRUPO ;	/**	 * @var LOGIN	 */	public $LOGIN ;	/**	 * @var NRO_MESA	 */	public $NRO_MESA ;	/**	 * @var NOTA	 */	public $NOTA ;	/**	 * @var ITEM_ELI	 */	public $ITEM_ELI ;	/**	 * @var NOM_EMPL	 */	public $NOM_EMPL ;		public $DELETEADO ;	public $TIEMPO ;	public $TIEMPO_INI ;	public $TIEMPO_FIN ;	public $ID ;function PRODUCTOS_MESAS_MYSQL($con) {$this->CON=$con;}	function contructor($FACTURA,$ORDEN,$ITEM,$COD_PROD,$CANTIDAD,$PRE_COSTO,$PRE_VENTA,$CAM_OF,$F_VENTA,$DHORAVEN,$NOM_PROD,$UNIDAD,$PENDIENTE,$ANULADO,$PRESA,$GRUPO,$CERRADO,$TURNO,$FAMILIA,$UNID,$SALIDA,$FORTAX,$TOT_DES,$FACTOR,$AGRUPA1,$AGRUPA2,$AGRUPA3,$COD_GRUPO,$LOGIN,$NRO_MESA,$NOTA,$ITEM_ELI,$NOM_EMPL,$DELETEADO,$TIEMPO,$TIEMPO_INI,$TIEMPO_FIN,$ID){	$this->FACTURA=$FACTURA;	$this->ORDEN=$ORDEN;	$this->ITEM=$ITEM;	$this->COD_PROD=$COD_PROD;	$this->CANTIDAD=$CANTIDAD;	$this->PRE_COSTO=$PRE_COSTO;	$this->PRE_VENTA=$PRE_VENTA;	$this->CAM_OF=$CAM_OF;	$this->F_VENTA=$F_VENTA;	$this->DHORAVEN=$DHORAVEN;	$this->NOM_PROD=$NOM_PROD;	$this->UNIDAD=$UNIDAD;	$this->PENDIENTE=$PENDIENTE;	$this->ANULADO=$ANULADO;	$this->PRESA=$PRESA;	$this->GRUPO=$GRUPO;	$this->CERRADO=$CERRADO;	$this->TURNO=$TURNO;	$this->FAMILIA=$FAMILIA;	$this->UNID=$UNID;	$this->SALIDA=$SALIDA;	$this->FORTAX=$FORTAX;	$this->TOT_DES=$TOT_DES;	$this->FACTOR=$FACTOR;	$this->AGRUPA1=$AGRUPA1;	$this->AGRUPA2=$AGRUPA2;	$this->AGRUPA3=$AGRUPA3;	$this->COD_GRUPO=$COD_GRUPO;	$this->LOGIN=$LOGIN;	$this->NRO_MESA=$NRO_MESA;	$this->NOTA=$NOTA;	$this->ITEM_ELI=$ITEM_ELI;	$this->NOM_EMPL=$NOM_EMPL;	$this->DELETEADO=$DELETEADO;	$this->TIEMPO=$TIEMPO;	$this->TIEMPO_INI=$TIEMPO_INI;	$this->TIEMPO_FIN=$TIEMPO_FIN;	$this->ID=$ID;	}function insertar() {    $consulta="INSERT INTO productos_mesas_mysql(FACTURA,ORDEN,ITEM,COD_PROD,CANTIDAD,PRE_COSTO,PRE_VENTA,CAM_OF,F_VENTA,DHORAVEN,NOM_PROD,UNIDAD,PENDIENTE,ANULADO,PRESA,GRUPO,CERRADO,TURNO,FAMILIA,UNID,SALIDA,FORTAX,TOT_DES,FACTOR,AGRUPA1,AGRUPA2,AGRUPA3,COD_GRUPO,LOGIN,NRO_MESA,NOTA,ITEM_ELI,NOM_EMPL,DELETEADO,TIEMPO,TIEMPO_INI,TIEMPO_FIN,ID)values('".$this->FACTURA."','".$this->ORDEN."','".$this->ITEM."','".$this->COD_PROD."','".$this->CANTIDAD."','".$this->PRE_COSTO."','".$this->PRE_VENTA."','".$this->CAM_OF."','".$this->F_VENTA."','".$this->DHORAVEN."','".$this->NOM_PROD."','".$this->UNIDAD."','".$this->PENDIENTE."','".$this->ANULADO."','".$this->PRESA."','".$this->GRUPO."','".$this->CERRADO."','".$this->TURNO."','".$this->FAMILIA."','".$this->UNID."','".$this->SALIDA."','".$this->FORTAX."','".$this->TOT_DES."','".$this->FACTOR."','".$this->AGRUPA1."','".$this->AGRUPA2."','".$this->AGRUPA3."','".$this->COD_GRUPO."','".$this->LOGIN."','".$this->NRO_MESA."','".$this->NOTA."','".$this->ITEM_ELI."','".$this->NOM_EMPL."','".$this->DELETEADO."','".$this->TIEMPO."','".$this->TIEMPO_INI."','".$this->TIEMPO_FIN."','".$this->ID."')"; if (!$this->CON->manipular($consulta))            return 0;        $consulta = "SELECT LAST_INSERT_ID() as id";        $resultado = $this->CON->consulta($consulta);        return $resultado->fetch_assoc()['id'];    }function rellenar($resultado){        if (count($resultado) > 0) {            $lista=array();            while($row = $resultado->fetch_assoc()) {	$productos_mesas_mysql= new PRODUCTOS_MESAS_MYSQL("");		$productos_mesas_mysql->FACTURA=$row["FACTURA"] ==null?"":$row["FACTURA"];		$productos_mesas_mysql->ORDEN=$row["ORDEN"] ==null?"":$row["ORDEN"];		$productos_mesas_mysql->ITEM=$row["ITEM"] ==null?"":$row["ITEM"];		$productos_mesas_mysql->COD_PROD=$row["COD_PROD"] ==null?"":$row["COD_PROD"];		$productos_mesas_mysql->CANTIDAD=$row["CANTIDAD"] ==null?"":$row["CANTIDAD"];		$productos_mesas_mysql->PRE_COSTO=$row["PRE_COSTO"] ==null?"":$row["PRE_COSTO"];		$productos_mesas_mysql->PRE_VENTA=$row["PRE_VENTA"] ==null?"":$row["PRE_VENTA"];		$productos_mesas_mysql->CAM_OF=$row["CAM_OF"] ==null?"":$row["CAM_OF"];		$productos_mesas_mysql->F_VENTA=$row["F_VENTA"] ==null?"":$row["F_VENTA"];		$productos_mesas_mysql->DHORAVEN=$row["DHORAVEN"] ==null?"":$row["DHORAVEN"];		$productos_mesas_mysql->NOM_PROD=$row["NOM_PROD"] ==null?"":$row["NOM_PROD"];		$productos_mesas_mysql->UNIDAD=$row["UNIDAD"] ==null?"":$row["UNIDAD"];		$productos_mesas_mysql->PENDIENTE=$row["PENDIENTE"] ==null?"":$row["PENDIENTE"];		$productos_mesas_mysql->ANULADO=$row["ANULADO"] ==null?"":$row["ANULADO"];		$productos_mesas_mysql->PRESA=$row["PRESA"] ==null?"":$row["PRESA"];		$productos_mesas_mysql->GRUPO=$row["GRUPO"] ==null?"":$row["GRUPO"];		$productos_mesas_mysql->CERRADO=$row["CERRADO"] ==null?"":$row["CERRADO"];		$productos_mesas_mysql->TURNO=$row["TURNO"] ==null?"":$row["TURNO"];		$productos_mesas_mysql->FAMILIA=$row["FAMILIA"] ==null?"":$row["FAMILIA"];		$productos_mesas_mysql->UNID=$row["UNID"] ==null?"":$row["UNID"];		$productos_mesas_mysql->SALIDA=$row["SALIDA"] ==null?"":$row["SALIDA"];		$productos_mesas_mysql->FORTAX=$row["FORTAX"] ==null?"":$row["FORTAX"];		$productos_mesas_mysql->TOT_DES=$row["TOT_DES"] ==null?"":$row["TOT_DES"];		$productos_mesas_mysql->FACTOR=$row["FACTOR"] ==null?"":$row["FACTOR"];		$productos_mesas_mysql->AGRUPA1=$row["AGRUPA1"] ==null?"":$row["AGRUPA1"];		$productos_mesas_mysql->AGRUPA2=$row["AGRUPA2"] ==null?"":$row["AGRUPA2"];		$productos_mesas_mysql->AGRUPA3=$row["AGRUPA3"] ==null?"":$row["AGRUPA3"];		$productos_mesas_mysql->COD_GRUPO=$row["COD_GRUPO"] ==null?"":$row["COD_GRUPO"];		$productos_mesas_mysql->LOGIN=$row["LOGIN"] ==null?"":$row["LOGIN"];		$productos_mesas_mysql->NRO_MESA=$row["NRO_MESA"] ==null?"":$row["NRO_MESA"];		$productos_mesas_mysql->NOTA=$row["NOTA"] ==null?"":$row["NOTA"];		$productos_mesas_mysql->ITEM_ELI=$row["ITEM_ELI"] ==null?"":$row["ITEM_ELI"];		$productos_mesas_mysql->NOM_EMPL=$row["NOM_EMPL"] ==null?"":$row["NOM_EMPL"];		$productos_mesas_mysql->DELETEADO=$row["DELETEADO"] ==null?"":$row["DELETEADO"];		$productos_mesas_mysql->TIEMPO=$row["TIEMPO"] ==null?"":$row["TIEMPO"];		$productos_mesas_mysql->TIEMPO_INI=$row["TIEMPO_INI"] ==null?"":$row["TIEMPO_INI"];		$productos_mesas_mysql->TIEMPO_FIN=$row["TIEMPO_FIN"] ==null?"":$row["TIEMPO_FIN"];				$productos_mesas_mysql->ID=$row["ID"] ==null?"":$row["ID"];		$lista[]=$productos_mesas_mysql;};	return $lista;}	else{            return null;        }}function todo(){        $consulta="select * from productos_mesas_mysql";        $result=$this->CON->consulta($consulta);        return $this->rellenar($result);    }function buscarXID($id){        $consulta="select * from productos_mesas_mysql where ID=".$id;        $result=$this->CON->consulta($consulta);        $productos_mesas_mysql=$this->rellenar($result);        if($productos_mesas_mysql==null){            return null;        }        return $productos_mesas_mysql;    }function listarDetalleMesa($idMesa,$nroMesa,$fecha){	  $consulta="select * from productos_mesas_mysql where NRO_MESA='".$idMesa."' and DELETEADO='' AND ITEM_ELI='' AND CERRADO=''  and productos_mesas_mysql.CANTIDAD<>0 and	F_VENTA='".$fecha."'" ;        $result=$this->CON->consulta($consulta);        $productos_mesas_mysql=$this->rellenar($result);        if($productos_mesas_mysql==null){            return "";        }        return $productos_mesas_mysql;}function listarDetalleDadaMesa($idMesa){	$consulta="select * from productos_mesas_mysql where NRO_MESA='".$idMesa."' and DELETEADO='' AND ITEM_ELI='' AND CERRADO=''" ;        $result=$this->CON->consulta($consulta);        $productos_mesas_mysql=$this->rellenar($result);        if($productos_mesas_mysql==null){            return null;        }        return $productos_mesas_mysql;}function modifcarProductoMesa($idDetalle,$cantidad){	$consulta="update productos_mesas_mysqlset CANTIDAD=".$cantidad." WHERE ID=".$idDetalle;   	return $this->CON->manipular($consulta);}function modificarDeleteadoCantidad($idDetalle){	$consulta="update productos_mesas_mysqlset CANTIDAD=0, DELETEADO='X'"." WHERE ID=".$idDetalle;   	return $this->CON->manipular($consulta);}function modificarItemElim($idDetalle){		$consulta="update productos_mesas_mysqlset ITEM_ELI='X' WHERE ID=".$idDetalle;   	return $this->CON->manipular($consulta);}function modifcarProductoMesaCerrado($idDetalle){	$consulta="update productos_mesas_mysqlset CERRADO='A', DELETEADO='S'"." WHERE ID=".$idDetalle;   	return $this->CON->manipular($consulta);}function modifcarProductoMesaAnulado($idDetalle){	$consulta="update productos_mesas_mysqlset CERRADO='X'"." WHERE ID=".$idDetalle;   	return $this->CON->manipular($consulta);} function listarPrintCocina($id,$fecha,$orden){ 	 $consulta="SELECT *, productos_mesas_mysql.NOM_PROD, productos_mesas_mysql.CANTIDAD FROM productos_mesas_mysql,productos_mysql WHERE productos_mesas_mysql.COD_PROD=productos_mysql.id and productos_mesas_mysql.NRO_MESA=".$id." and productos_mysql.impcoc<>''  and DELETEADO='' AND ITEM_ELI='' AND CERRADO='' and productos_mesas_mysql.ORDEN=".$orden."  and	F_VENTA='".$fecha."' and productos_mesas_mysql.CANTIDAD<>0  ORDER by  productos_mesas_mysql.ITEM asc";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function listarPrintPunto($id,$index,$fecha,$orden){ 	  $consulta="SELECT *, productos_mesas_mysql.NOM_PROD,productos_mesas_mysql.CANTIDAD FROM productos_mesas_mysql,productos_mysql WHERE productos_mesas_mysql.COD_PROD=productos_mysql.id and productos_mesas_mysql.ORDEN=".$orden." and productos_mesas_mysql.NRO_MESA=".$id." and productos_mysql.imppunt".$index."<>''   and DELETEADO='' AND ITEM_ELI='' AND CERRADO='' and	F_VENTA='".$fecha."' and productos_mesas_mysql.CANTIDAD<>0 ORDER by  productos_mesas_mysql.ITEM asc";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function listarProductosMesas2Fechas($fechaInicio,$fechaFinal,$idMesa){ 	 $consulta="SELECT  *,sum(CANTIDAD)AS CANTIDAD FROM productos_mesas_mysql WHERE ITEM_ELI=''  and	F_VENTA BETWEEN '$fechaInicio' and '$fechaFinal' and NRO_MESA=$idMesa group by NOM_PROD";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function listarProductosMeseros2Fechas($fechaInicio,$fechaFinal,$nomMesero){  $consulta="SELECT  *,sum(CANTIDAD)AS CANTIDAD FROM productos_mesas_mysql WHERE ITEM_ELI=''  and	F_VENTA BETWEEN '$fechaInicio' and '$fechaFinal' and NOM_EMPL='$nomMesero' group by NOM_PROD";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function listarItemAnulado2Fechas($fechaInicio,$fechaFinal){ 	 	 $consulta="SELECT  *,sum(CANTIDAD)AS CANTIDAD FROM productos_mesas_mysql WHERE ITEM_ELI<>''  and	F_VENTA BETWEEN '$fechaInicio' and '$fechaFinal'  group by NOM_PROD";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function listarMesasAnuladas2Fechas($fechaInicio,$fechaFinal){ 		  $consulta="SELECT  *,sum(CANTIDAD)AS CANTIDAD FROM productos_mesas_mysql WHERE CERRADO='A'  and	F_VENTA BETWEEN '$fechaInicio' and '$fechaFinal'  group by NOM_PROD,NRO_MESA";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function listarItemAnuladoFechas($fecha){ $consulta="SELECT  *,sum(CANTIDAD)AS CANTIDAD FROM productos_mesas_mysql WHERE ITEM_ELI<>''  and	F_VENTA='$fecha'  group by NOM_PROD,NRO_MESA";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql; } function totalDetalle($idMesa,$nroMesa,$fecha){ // 	$consulta="SELECT  *,sum(CANTIDAD)AS CANTIDAD // FROM productos_mesas_mysql // WHERE ITEM_ELI<>''  and	F_VENTA BETWEEN '$fechaInicio' and '$fechaFinal'  group by NOM_PROD"; //        $result=$this->CON->consulta($consulta); //        $detalles_mysql=$this->rellenar($result); //        if($detalles_mysql==null){ //            return ""; //        } //        return $detalles_mysql; } function pararTiempoBillar($idDetalle,$now){ 	 $consulta="update productos_mesas_mysqlset TIEMPO_FIN='$now'   WHERE ID=".$idDetalle;   	return $this->CON->manipular($consulta);}  function verificarPrdT($idMesa,$fecha){  	$consulta="SELECT  * from productos_mesas_mysql where TIEMPO_FIN='' AND TIEMPO='T' AND NRO_MESA='".$idMesa."' and DELETEADO='' AND ITEM_ELI='' AND CERRADO='' and F_VENTA='$fecha'";        $result=$this->CON->consulta($consulta);        $detalles_mysql=$this->rellenar($result);        if($detalles_mysql==null){            return "";        }        return $detalles_mysql;  }}//  function pararTiempoTodoBillar($idDetalle,$now,$idMesa){//  	$consulta="update productos_mesas_mysql// set TIEMPO_FIN='$now'   WHERE NRO_MESA=".$idMesa." AND CERRADO='' AND DELETEADO='' AND COD_PROD=99999";//    	return $this->CON->manipular($consulta);}// }