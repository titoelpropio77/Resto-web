<?php/** * RELPROGRU_MYSQL.class.php *  **/class RELPROGRU_MYSQL {    public static $DATABASE_NAME = 'posgourmet';    public static $TABLE_NAME = 'relprogru_mysql';public $CONN;    public $ID ;    public $COD_GRUPO ;    public $COD_PROD ;    public $CANTIDAD ;    public $UNIDAD ;    public $FACTOR ;    public $NOM_PROD ;    public $CANGRUPO ;    public $ORDEN ;    public $NOM_GRUPO ;function RELPROGRU_MYSQL($con) {$this->CON=$con;}    function contructor($ID,$COD_GRUPO,$COD_PROD,$CANTIDAD,$UNIDAD,$FACTOR,$NOM_PROD,$CANGRUPO,$ORDEN,$NOM_GRUPO){    $this->ID=$ID;    $this->COD_GRUPO=$COD_GRUPO;    $this->COD_PROD=$COD_PROD;    $this->CANTIDAD=$CANTIDAD;    $this->UNIDAD=$UNIDAD;    $this->FACTOR=$FACTOR;    $this->NOM_PROD=$NOM_PROD;    $this->CANGRUPO=$CANGRUPO;    $this->ORDEN=$ORDEN;    $this->NOM_GRUPO=$NOM_GRUPO;    }function insertar() { $consulta="INSERT INTO relprogru_mysql(ID,COD_GRUPO,COD_PROD,CANTIDAD,UNIDAD,FACTOR,NOM_PROD,CANGRUPO,ORDEN)values('".$this->ID."','".$this->COD_GRUPO."','".$this->COD_PROD."','".$this->CANTIDAD."','".$this->UNIDAD."','".$this->FACTOR."','".$this->NOM_PROD."','".$this->CANGRUPO."','".$this->ORDEN."')";if (!$this->CON->manipular($consulta))            return 0;        $consulta = "SELECT LAST_INSERT_ID() as id";        $resultado = $this->CON->consulta($consulta);        return $resultado->fetch_assoc()['id'];}function rellenar($resultado){        if (count($resultado)) {            $lista=array();            while($row = $resultado->fetch_assoc()) {    $relprogru_mysql= new RELPROGRU_MYSQL("");        $relprogru_mysql->ID=$row["ID"] ==null?"":$row["ID"];        $relprogru_mysql->COD_GRUPO=$row["COD_GRUPO"] ==null?"":$row["COD_GRUPO"];        $relprogru_mysql->COD_PROD=$row["COD_PROD"] ==null?"":$row["COD_PROD"];        $relprogru_mysql->CANTIDAD=$row["CANTIDAD"] ==null?"":$row["CANTIDAD"];        $relprogru_mysql->UNIDAD=$row["UNIDAD"] ==null?"":$row["UNIDAD"];        $relprogru_mysql->FACTOR=$row["FACTOR"] ==null?"":$row["FACTOR"];        $relprogru_mysql->NOM_PROD=$row["NOM_PROD"] ==null?"":$row["NOM_PROD"];        $relprogru_mysql->CANGRUPO=$row["CANGRUPO"] ==null?"":$row["CANGRUPO"];        $relprogru_mysql->ORDEN=$row["ORDEN"] ==null?"":$row["ORDEN"];        $relprogru_mysql->NOM_GRUPO=$row["NOM_GRUPO"] ==null?"":$row["NOM_GRUPO"];        $lista[]=$relprogru_mysql;    }    return $lista;}    else{            return null;        }}function todo(){        $consulta="select * from relprogru_mysql";        $result=$this->CON->consulta($consulta);        return $this->rellenar($result);    }function buscarXID($id){        $consulta="SELECT *  FROM grupos_mysql,relprogru_mysql,productos_mysql where relprogru_mysql.COD_GRUPO=grupos_mysql.ID and relprogru_mysql.COD_PROD=productos_mysql.id and productos_mysql.id=".$id;        $result=$this->CON->consulta($consulta);        $relprogru_mysql=$this->rellenar($result);        if($relprogru_mysql==null){                           return "";        }        return $relprogru_mysql;    }    function modificar($id,$factor){           $consulta = "update relprogru_mysqlset factor=".$factor." WHERE id=". $id;        return $this->CON->manipular($consulta);    }    function eliminar($id){           $consulta = "DELETE from relprogru_mysql WHERE relprogru_mysql.ID=".$id;        return $this->CON->manipular($consulta);    }    function listarFactorGrupo(){//RENOMBREO NOM_GRUPO PARA PODER UTILIZAR LA VARIABLE NOM_PROD EN LA CLASE trim(coalesce(phone2, '')) <>''        $consulta="SELECT (sum(detalles_mysql.cantidad)*detalles_mysql.unid*relprogru_mysql.FACTOR) as CANTIDAD ,         grupos_mysql.NOM_GRUPO , relprogru_mysql.NOM_PROD,grupos_mysql.COD_GRUPO,grupos_mysql.ID,relprogru_mysql.COD_PROD,        CANGRUPO,relprogru_mysql.ORDEN,relprogru_mysql.UNIDAD,relprogru_mysql.FACTOR         FROM relprogru_mysql,grupos_mysql,detalles_mysql where relprogru_mysql.COD_PROD=detalles_mysql.cod_prod         and relprogru_mysql.COD_GRUPO=grupos_mysql.COD_GRUPO and detalles_mysql.ANULADO <>'S' GROUP by grupos_mysql.NOM_GRUPO";         $result=$this->CON->consulta($consulta);        $relprogru_mysql=$this->rellenar($result);        if($relprogru_mysql==null){                            return "";        }        return $relprogru_mysql;    }    function listarFactorGrupoFecha($fecha,$empleado,$turno){         switch ($turno) {            case 'MAÑANA Y NOCHE':            if ($empleado == "") {               $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fecha' and '$fecha' GROUP BY vistaRelprogruDet.NOM_GRUPO";            } else {                $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fecha' and '$fecha' and LOGIN='$empleado'  GROUP BY vistaRelprogruDet.NOM_GRUPO";            }            break;            case 'MAÑANA':            if ($empleado == "") {                $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fecha' and '$fecha' and TURNO='$turno' GROUP BY vistaRelprogruDet.NOM_GRUPO";            } else {                $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fecha' and '$fecha' and LOGIN='$empleado' and TURNO='$turno' GROUP BY vistaRelprogruDet.NOM_GRUPO";            }            break;            case 'NOCHE':            if ($empleado == "") {                $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fecha' and '$fecha'  and TURNO='$turno' GROUP BY vistaRelprogruDet.NOM_GRUPO";            } else {                $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fecha' and '$fecha' and LOGIN='$empleado' and TURNO='$turno' GROUP BY vistaRelprogruDet.NOM_GRUPO";            }            break;            default:                # code...            break;        }             $result=$this->CON->consulta($consulta);        $relprogru_mysql=$this->rellenar($result);        if($relprogru_mysql==null){                            return "";        }        return $relprogru_mysql;    }    function listarGrupoDada2Fechas($fechaInicio,$fechaFinal){       $consulta="SELECT SUM(CANTIDAD)AS CANTIDAD,NOM_GRUPO, NOM_GRUPO ,COD_GRUPO,ID,COD_PROD,NOM_PROD,    CANGRUPO,ORDEN,UNIDAD,FACTOR FROM vistaRelprogruDet WHERE  vistaRelprogruDet.F_VENTA BETWEEN  '$fechaInicio' and '$fechaFinal' GROUP BY vistaRelprogruDet.NOM_GRUPO";         $result=$this->CON->consulta($consulta);        $relprogru_mysql=$this->rellenar($result);        if($relprogru_mysql==null){                            return "";        }        return $relprogru_mysql;    }    function listarFactorDeTarjeta($fecha){        $consulta="SELECT (sum(dettarjeta_mysql.cantidad)*dettarjeta_mysql.UNID*relprogru_mysql.FACTOR) as CANTIDAD ,    grupos_mysql.NOM_GRUPO , relprogru_mysql.NOM_PROD,grupos_mysql.COD_GRUPO,grupos_mysql.ID,relprogru_mysql.COD_PROD,    CANGRUPO,relprogru_mysql.ORDEN,relprogru_mysql.UNIDAD,relprogru_mysql.FACTOR     FROM relprogru_mysql,grupos_mysql,dettarjeta_mysql  where relprogru_mysql.COD_PROD=dettarjeta_mysql.COD_PROD and dettarjeta_mysql.F_VENTA='$fecha'     and relprogru_mysql.COD_GRUPO=grupos_mysql.ID GROUP by grupos_mysql.NOM_GRUPO;";         $result=$this->CON->consulta($consulta);        $relprogru_mysql=$this->rellenar($result);        if($relprogru_mysql==null){                            return "";        }        return $relprogru_mysql;    }    function verProductosGrupo($id){          $consulta="  select relprogru_mysql.CANTIDAD , grupos_mysql.NOM_GRUPO,relprogru_mysql.NOM_PROD,grupos_mysql.COD_GRUPO,grupos_mysql.ID,relprogru_mysql.COD_PROD,    CANGRUPO,relprogru_mysql.ORDEN,relprogru_mysql.UNIDAD,relprogru_mysql.FACTOR  from productos_mysql,relprogru_mysql,grupos_mysql where  relprogru_mysql.COD_GRUPO=grupos_mysql.ID and productos_mysql.ID=relprogru_mysql.COD_PROD and relprogru_mysql.COD_GRUPO=$id";         $result=$this->CON->consulta($consulta);        $relprogru_mysql=$this->rellenar($result);        if($relprogru_mysql==null){                            return "";        }        return $relprogru_mysql;    }    function modificarGrupoPro($id,$nombre,$orden){        $consulta = "update grupos_mysqlset ORDEN=".$orden." , NOM_GRUPO='$nombre' WHERE id=". $id;        return $this->CON->manipular($consulta);    }}